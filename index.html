<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haunted Map - Paranormal Locations</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0f0f0f 0%, #1a0a0a 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c1810, #4a2c17);
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 2px 20px rgba(255, 107, 53, 0.3);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .header-logo {
            max-height: 120px;
            max-width: 300px;
            height: auto;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.7));
        }

        .header-text {
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            color: #ff6b35;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            margin-bottom: 10px;
        }

        .header p {
            color: #cccccc;
            font-size: 1.1em;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .header-logo {
                max-height: 90px;
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .map-controls {
            background: rgba(42, 42, 42, 0.9);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-group label {
            color: #ff6b35;
            font-size: 0.9em;
            font-weight: bold;
        }

        select, input {
            padding: 8px;
            border: 1px solid #555;
            border-radius: 5px;
            background: #333;
            color: white;
            font-size: 14px;
        }

        .generate-btn {
            background: linear-gradient(135deg, #ff6b35, #e55a2e);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s ease;
            margin-left: auto;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.4);
        }

        .map-container {
            background: rgba(42, 42, 42, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        #map {
            width: 100%;
            height: 500px;
            border-radius: 10px;
            border: 2px solid #444;
            position: relative;
            z-index: 1;
        }

        /* Dark theme for the map */
        .leaflet-tile {
            filter: brightness(0.3) contrast(1.5) saturate(0.8) hue-rotate(180deg);
        }

        /* Custom marker styles */
        .haunted-marker {
            background: radial-gradient(circle, #ff6b35, #cc4a1a);
            border: 2px solid #fff;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            box-shadow: 0 2px 10px rgba(255, 107, 53, 0.7);
            animation: pulse 2s infinite;
            cursor: pointer;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 107, 53, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 107, 53, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 107, 53, 0); }
        }

        /* Custom popup styles */
        .leaflet-popup-content-wrapper {
            background: rgba(0, 0, 0, 0.95) !important;
            border: 2px solid #ff6b35 !important;
            border-radius: 10px !important;
            color: #fff !important;
        }

        .leaflet-popup-content {
            color: #fff !important;
            margin: 15px !important;
        }

        .leaflet-popup-content h3 {
            color: #ff6b35 !important;
            margin-bottom: 8px !important;
            font-size: 1.1em !important;
        }

        .leaflet-popup-content p {
            color: #ccc !important;
            font-size: 0.9em !important;
            line-height: 1.4 !important;
        }

        .leaflet-popup-tip {
            background: rgba(0, 0, 0, 0.95) !important;
            border: 2px solid #ff6b35 !important;
        }

        .leaflet-popup-close-button {
            color: #ff6b35 !important;
            font-size: 18px !important;
            font-weight: bold !important;
        }

        .locations-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .location-card {
            background: linear-gradient(145deg, #2a2a2a, #1f1f1f);
            border: 1px solid #444;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .location-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #ff6b35, #ff8c42, #ff6b35);
        }

        .location-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(255, 107, 53, 0.2);
            border-color: #ff6b35;
        }

        /* Location Image Styling */
        .location-image {
            width: 100%;
            height: 200px;
            overflow: hidden;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .location-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .location-card:hover .location-image img {
            transform: scale(1.05);
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .location-image {
                height: 150px;
            }
        }

        .location-title {
            color: #ff6b35;
            font-size: 1.3em;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .location-type {
            display: inline-block;
            background: rgba(255, 107, 53, 0.2);
            color: #ff6b35;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            margin-bottom: 15px;
            border: 1px solid #ff6b35;
        }

        .location-story {
            color: #ccc;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .location-features {
            border-top: 1px solid #333;
            padding-top: 15px;
        }

        .location-features h4 {
            color: #ff6b35;
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .features-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .feature-tag {
            background: rgba(255, 107, 53, 0.1);
            color: #ff6b35;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            border: 1px solid rgba(255, 107, 53, 0.3);
        }

        .loading {
            text-align: center;
            color: #ff6b35;
            font-size: 1.2em;
            padding: 40px;
        }

        .instructions {
            background: rgba(42, 42, 42, 0.8);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #ff6b35;
        }

        .instructions h3 {
            color: #ff6b35;
            margin-bottom: 10px;
        }

        .instructions p {
            color: #ccc;
            line-height: 1.5;
        }

        .coordinates {
            color: #aaa;
            font-size: 0.8em;
            margin-bottom: 10px;
        }

        .activity-high { border-left: 5px solid #ff4444; }
        .activity-moderate { border-left: 5px solid #ffaa44; }
        .activity-low { border-left: 5px solid #44ff44; }

        .statistics {
            background: rgba(42, 42, 42, 0.9);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-around;
            text-align: center;
        }

        .stat-item {
            color: #ff6b35;
        }

        .stat-number {
            font-size: 1.5em;
            font-weight: bold;
        }

        .image-management {
            background: rgba(42, 42, 42, 0.9);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            border: 2px solid #ff6b35;
        }

        .fetch-images-btn {
            background: linear-gradient(135deg, #ff6b35, #e55a2e);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
            transition: all 0.3s ease;
        }

        .fetch-images-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }

        .fetch-images-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        @media (max-width: 768px) {
            .map-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .generate-btn {
                margin-left: 0;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .locations-list {
                grid-template-columns: 1fr;
            }

            .statistics {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content-alternative">
            <img src="fulllogo.jpg" alt="Logo" class="header-logo">
            <div class="header-text-alternative">
                <h1>Interactive Haunted Map</h1>
                <p>Explore Haunted Places and Attractions with Stories.</p>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="instructions">
            <h3>üó∫Ô∏è How to Use the Map</h3>
            <p>Select your preferences below and click "Apply Filters" to populate the haunted sites. Click on any ghost marker to view the location details. Currently featuring <strong>35 documented haunted locations</strong> in Alabama!</p>
        </div>

        <div class="statistics">
            <div class="stat-item">
                <div class="stat-number" id="totalLocations">35</div>
                <div>Total Locations</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="highActivity">12</div>
                <div>High Activity</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="displayedCount">0</div>
                <div>Currently Displayed</div>
            </div>
        </div>

        <div class="image-management">
            <h3 style="color: #ff6b35; margin-bottom: 15px;">Conjure New Images</h3>
            <button id="fetchImagesBtn" class="fetch-images-btn" onclick="updateHauntedSitesWithImages()">
                Click to Show Location Images
            </button>
            <p style="color: #ccc; font-size: 0.9em; margin-top: 10px;">
                Lift the veil with real haunted photos.
            </p>
            <div id="imageProgress" style="margin-top: 15px; color: #ff6b35; display: none;"></div>
        </div>

        <div class="map-controls">
            <div class="control-group">
                <label>State:</label>
                <select id="stateFilter">
                    <option value="">All States</option>
                    <option value="AL" selected>Alabama</option>
                    <option value="AK">Alaska</option>
                    <option value="AZ">Arizona</option>
                    <option value="AR">Arkansas</option>
                    <option value="CA">California</option>
                    <option value="CO">Colorado</option>
                    <option value="CT">Connecticut</option>
                    <option value="DE">Delaware</option>
                    <option value="FL">Florida</option>
                    <option value="GA">Georgia</option>
                    <option value="HI">Hawaii</option>
                    <option value="ID">Idaho</option>
                    <option value="IL">Illinois</option>
                    <option value="IN">Indiana</option>
                    <option value="IA">Iowa</option>
                    <option value="KS">Kansas</option>
                    <option value="KY">Kentucky</option>
                    <option value="LA">Louisiana</option>
                    <option value="ME">Maine</option>
                    <option value="MD">Maryland</option>
                    <option value="MA">Massachusetts</option>
                    <option value="MI">Michigan</option>
                    <option value="MN">Minnesota</option>
                    <option value="MS">Mississippi</option>
                    <option value="MO">Missouri</option>
                    <option value="MT">Montana</option>
                    <option value="NB">Nebraska</option>
                    <option value="NH">New Hampshire</option>
                    <option value="NJ">New Jersey</option>
                    <option value="NM">New Mexico</option>
                    <option value="NY">New York</option>
                    <option value="NC">North Carolina</option>
                    <option value="ND">North Dakota</option>
                    <option value="OH">Ohio</option>
                    <option value="OK">Oklahoma</option>
                    <option value="OR">Oregon</option>
                    <option value="PA">Pennsylvania</option>
                    <option value="PR">Puerto Rico</option>
                    <option value="RI">Rhode Island</option>
                    <option value="SC">South Carolina</option>
                    <option value="SD">South Dakota</option>
                    <option value="TN">Tennessee</option>
                    <option value="TX">Texas</option>
                    <option value="UT">Utah</option>
                    <option value="VT">Vermont</option>
                    <option value="VA">Virginia</option>
                    <option value="WA">Washington</option>
                    <option value="WV">West Virginia</option>
                    <option value="WI">Wisconsin</option>
                    <option value="WY">Wyoming</option>
                </select>
            </div>

            <div class="control-group">
                <label>Location Type:</label>
                <select id="locationType">
                    <option value="">All Types</option>
                    <option value="Cemetery">Cemeteries</option>
                    <option value="Church">Churches</option>
                    <option value="College">Colleges</option>
                    <option value="Ghost Town">Ghost Towns</option>
                    <option value="Historic House">Historic Houses</option>
                    <option value="Hotel">Hotels</option>
                    <option value="Industrial Site">Industrial Sites</option>
                    <option value="Military Site">Military Sites</option>
                    <option value="Mining">Mining Sites</option>
                    <option value="Prison">Prisons</option>
                    <option value="Restaurant">Restaurants</option>
                    <option value="Saloon">Saloons</option>
                    <option value="Terrain">Terrain</option>                    
                    <option value="Theater">Theaters</option>
                </select>
            </div>

            <div class="control-group">
                <label>Activity Level:</label>
                <select id="activityLevel">
                    <option value="">All Levels</option>
                    <option value="low">Low Activity</option>
                    <option value="moderate">Moderate Activity</option>
                    <option value="high">High Activity</option>
                </select>
            </div>

            <div class="control-group">
                <label>Sort By:</label>
                <select id="sortOrder">
                    <option value="alphabetical">Alphabetical (A-Z)</option>
                    <option value="alphabetical-desc">Alphabetical (Z-A)</option>
                    <option value="activity">Activity Level</option>
                    <option value="year">Year Established</option>
                    <option value="type">Location Type</option>
                    <option value="city">City Name</option>
                </select>
            </div>

            <button class="generate-btn" onclick="filterAndDisplayLocations()">
                Apply Filters
            </button>
        </div>

        <div class="map-container">
            <div id="map"></div>
        </div>

        <div id="locationsList" class="locations-list">
            <!-- Generated locations will appear here -->
        </div>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    
    <script>
        // === IMAGE FETCHER CODE ===
        class HauntedImageFetcher {
            constructor(unsplashApiKey) {
                this.apiKey = unsplashApiKey;
                this.cache = new Map();
                this.rateLimitDelay = 1100;
                
                this.fallbackImages = {
                    "Cemetery": "https://source.unsplash.com/800x600/?cemetery,gothic,historic",
                    "Church": "https://source.unsplash.com/800x600/?church,historic,architecture",
                    "College": "https://source.unsplash.com/800x600/?university,campus,historic",
                    "Ghost Town": "https://source.unsplash.com/800x600/?abandoned,town,desert",
                    "Historic House": "https://source.unsplash.com/800x600/?mansion,victorian,historic",
                    "Hotel": "https://source.unsplash.com/800x600/?hotel,historic,vintage",
                    "Industrial Site": "https://source.unsplash.com/800x600/?industrial,abandoned,factory",
                    "Military Site": "https://source.unsplash.com/800x600/?fort,military,historic",
                    "Mining Site": "https://source.unsplash.com/800x600/?mine,abandoned,industrial",
                    "Prison": "https://source.unsplash.com/800x600/?prison,bars,abandoned",
                    "Restaurant": "https://source.unsplash.com/800x600/?restaurant,historic,vintage",
                    "Saloon": "https://source.unsplash.com/800x600/?saloon,western,vintage",
                    "Terrain": "https://source.unsplash.com/800x600/?landscape,spooky,dark",
                    "Theater": "https://source.unsplash.com/800x600/?theater,vintage,architecture"
                };
            }

            createSearchQuery(site) {
                const { name, city, state, type } = site;
                const cleanName = name.replace(/^The\s+/i, '').replace(/\s+(House|Hotel|Theater|Prison)$/i, '');
                
                return [
                    `${name} ${city} ${state}`,
                    `${cleanName} ${city} historic`,
                    `${name} haunted`,
                    `${type.toLowerCase()} ${city} ${state}`,
                    `historic ${type.toLowerCase()}`
                ];
            }

            async fetchFromUnsplash(query) {
                if (this.cache.has(query)) {
                    return this.cache.get(query);
                }

                try {
                    const response = await fetch(
                        `https://api.unsplash.com/search/photos?query=${encodeURIComponent(query)}&per_page=3&orientation=landscape`,
                        {
                            headers: {
                                'Authorization': `Client-ID ${this.apiKey}`
                            }
                        }
                    );

                    if (!response.ok) {
                        throw new Error(`API request failed: ${response.status}`);
                    }

                    const data = await response.json();
                    
                    if (data.results && data.results.length > 0) {
                        const bestImage = data.results.find(img => 
                            img.description && (
                                img.description.toLowerCase().includes('historic') ||
                                img.description.toLowerCase().includes('architecture') ||
                                img.description.toLowerCase().includes('building')
                            )
                        ) || data.results[0];
                        
                        const imageUrl = bestImage.urls.regular;
                        this.cache.set(query, imageUrl);
                        return imageUrl;
                    }
                } catch (error) {
                    console.warn(`Failed to fetch image for query "${query}":`, error.message);
                }
                
                return null;
            }

            async getImageForSite(site) {
                const queries = this.createSearchQuery(site);
                
                for (const query of queries) {
                    console.log(`Trying query: "${query}" for ${site.name}`);
                    
                    const imageUrl = await this.fetchFromUnsplash(query);
                    if (imageUrl) {
                        console.log(`‚úì Found image for ${site.name}: ${imageUrl}`);
                        return imageUrl;
                    }
                    
                    await this.delay(this.rateLimitDelay);
                }
                
                const fallbackUrl = this.fallbackImages[site.type] || this.fallbackImages["Historic House"];
                console.log(`Using fallback image for ${site.name}: ${fallbackUrl}`);
                return fallbackUrl;
            }

            async processAllSites(sites, progressCallback) {
                const updatedSites = [];
                
                console.log(`Processing ${sites.length} sites...`);
                
                for (let i = 0; i < sites.length; i++) {
                    const site = sites[i];
                    
                    try {
                        console.log(`[${i + 1}/${sites.length}] Processing: ${site.name}`);
                        
                        if (progressCallback) {
                            progressCallback(i + 1, sites.length, site.name);
                        }
                        
                        const imageUrl = await this.getImageForSite(site);
                        
                        const updatedSite = {
                            ...site,
                            imageUrl: imageUrl
                        };
                        
                        updatedSites.push(updatedSite);
                        
                    } catch (error) {
                        console.error(`Error processing ${site.name}:`, error);
                        updatedSites.push({
                            ...site,
                            imageUrl: this.fallbackImages[site.type] || this.fallbackImages["Historic House"]
                        });
                    }
                }
                
                return updatedSites;
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // Function to update your haunted locations with real images
        async function updateHauntedSitesWithImages() {
            const apiKey = '3t7QkwquuCZ6faMM80mIMkrAQlybHcukcnrRADjhy_M'; // Replace with your actual API key
            
            if (apiKey === 'YOUR_UNSPLASH_API_KEY_HERE') {
                alert('Please add your Unsplash API key to the script first!');
                return;
            }
            
            const fetcher = new HauntedImageFetcher(apiKey);
            const progressDiv = document.getElementById('imageProgress');
            const button = document.getElementById('fetchImagesBtn');
            
            try {
                button.disabled = true;
                button.textContent = 'üîÑ Fetching Images...';
                progressDiv.style.display = 'block';
                progressDiv.textContent = 'Starting image fetch process...';
                
                console.log('Starting image fetch process...');
                
                const updatedSites = await fetcher.processAllSites(hauntedLocations, (current, total, siteName) => {
                    progressDiv.textContent = `Processing ${current}/${total}: ${siteName}`;
                });
                
                // Replace the original array with updated images
                hauntedLocations.length = 0;
                hauntedLocations.push(...updatedSites);
                
                console.log('‚úì Image fetch complete! Refreshing display...');
                progressDiv.textContent = '‚úì Image fetch complete! Refreshing display...';
                
                // Refresh the display with new images
                filterAndDisplayLocations();
                
                setTimeout(() => {
                    progressDiv.style.display = 'none';
                    button.disabled = false;
                    button.textContent = '‚úì Images Updated Successfully!';
                    
                    setTimeout(() => {
                        button.textContent = 'üîÆ Fetch Real Images for All Locations';
                    }, 3000);
                }, 2000);
                
            } catch (error) {
                console.error('Error updating images:', error);
                progressDiv.textContent = '‚ùå Error fetching images. Check console for details.';
                button.disabled = false;
                button.textContent = 'üîÆ Fetch Real Images for All Locations';
            }
        }
        // === END IMAGE FETCHER CODE ===

        // Initialize the map - Center on Alabama initially
        let map = L.map('map').setView([32.806671, -86.79113], 7);

        // Add dark-themed tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 18,
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        // Store markers for clearing
        let markersGroup = L.layerGroup().addTo(map);

        // Optimized haunted locations database - Alabama locations
        const hauntedLocations = [
            {
                id: "al001",
                state: "AL",
                name: "Sloss Furnaces",
                city: "Birmingham",
                coordinates: [33.5186, -86.8025],
                story: "Former iron-producing facility where harsh working conditions led to numerous fatal accidents. James 'Slag' Wormwood, a brutal foreman, pushed workers to dangerous limits until 47 died under his watch.",
                features: ["Disembodied Voices", "Physical Pushing", "Apparitions", "Extreme Cold Spots"],
                activityLevel: "high",
                yearEstablished: 1882,
                type: "Industrial Site",
                imageUrl: "https://example.com/images/sloss-furnaces.jpg"
            },
            {
                id: "al002",
                state: "AL",
                name: "The Drish House",
                city: "Tuscaloosa",
                coordinates: [33.2098, -87.5692],
                story: "Antebellum mansion where Dr. John R. Drish died from a drunken fall in 1867. His widow Sarah became obsessed with preserving his funeral candles.",
                features: ["Phantom Fires", "Ghostly Lights", "Apparitions", "Cold Spots"],
                activityLevel: "high",
                yearEstablished: 1837,
                type: "Historic House",
                imageUrl: "https://example.com/images/the-drish-house.jpg"
            },
            {
                id: "al003",
                state: "AL",
                name: "Dead Children's Playground",
                city: "Huntsville",
                coordinates: [34.7304, -86.5861],
                story: "Playground within Maple Hill Cemetery where children who died during the 1918 Spanish flu epidemic are buried.",
                features: ["Self-Moving Swings", "Children's Laughter", "Orbs in Photos", "Disembodied Voices"],
                activityLevel: "high",
                yearEstablished: 1822,
                type: "Cemetery",
                imageUrl: "https://example.com/images/dead-children-playground.jpg"
            },
            {
                id: "al004",
                state: "AL",
                name: "Fort Morgan",
                city: "Gulf Shores",
                coordinates: [30.2297, -88.0209],
                story: "This historic coastal fort witnessed the bloody Battle of Mobile Bay during the Civil War and served through both World Wars. The spirits of soldiers who died defending this strategic position linger in the barracks and corridors. Visitors report hearing anguished cries of fallen men and seeing a mysterious woman searching for justice.",
                features: ["Military Apparitions", "Disembodied Screams", "Cold Spots", "Shadow Figures"],
                activityLevel: "moderate",
                yearEstablished: 1819,
                type: "Military Site"
            },
            {
                id: "al005",
                state: "AL",
                name: "Gaines Ridge Dinner Club",
                city: "Camden",
                coordinates: [31.9929, -87.2892],
                story: "Operating in an 1820s antebellum home, this restaurant is known as 'Alabama's Most Haunted Restaurant.' The historic mansion houses an entire family of spirits who make their presence known through various manifestations. Diners frequently experience unexplained phenomena while enjoying their meals.",
                features: ["Apparitions in Mirrors", "Phantom Baby Cries", "Pipe Smoke Aromas", "Floating Women"],
                activityLevel: "moderate",
                yearEstablished: 1820,
                type: "Restaurant"
            },
            {
                id: "al006",
                state: "AL",
                name: "USS Alabama Battleship",
                city: "Mobile",
                coordinates: [30.6818, -88.0148],
                story: "This 680-foot WWII battleship serves as both a museum and home to restless spirits. The vessel was completed in 1942 and served three years without enemy casualties, but tragic accidents during construction and friendly fire incidents claimed lives. Eight crewmen died in a devastating friendly-fire accident.",
                features: ["Military Spirits", "Cold Spots", "Disembodied Voices", "Equipment Malfunctions"],
                activityLevel: "moderate",
                yearEstablished: 1942,
                type: "Military Site"
            },
            {
                id: "al007",
                state: "AL",
                name: "St. James Hotel",
                city: "Selma",
                coordinates: [32.4074, -87.0211],
                story: "Built in 1837, this historic hotel served as Union headquarters during the Civil War and later hosted infamous outlaw Jesse James and his gang in 1881. After closing for nearly 100 years, it reopened in 1997 with its ghostly residents intact. Jesse appears in his signature cowboy attire while his girlfriend Lucinda leaves the scent of lavender perfume.",
                features: ["Outlaw Apparitions", "Lavender Scents", "Ghost Dog Barking", "1800s Period Spirits"],
                activityLevel: "high",
                yearEstablished: 1837,
                type: "Hotel"
            },
            {
                id: "al008",
                state: "AL",
                name: "Old Cahawba Ghost Town",
                city: "Orrville",
                coordinates: [32.3082, -87.1150],
                story: "Once Alabama's first state capital from 1820-1825, this thriving river town was abandoned after repeated flooding and economic collapse. Built atop a 16th-century Mississippian Indian village, the site contains layers of tragic history including a Confederate prison camp known as Castle Morgan.",
                features: ["Disembodied Voices", "Children's Laughter", "Historical Apparitions", "Ancient Spiritual Energy"],
                activityLevel: "moderate",
                yearEstablished: 1820,
                type: "Ghost Town"
            },
            {
                id: "al009",
                state: "AL",
                name: "The Boyington Oak",
                city: "Mobile",
                coordinates: [30.6944, -88.0444],
                story: "This massive Southern live oak grew from the grave of Charles Boyington, who was wrongfully executed for murder in 1835. Before his hanging, Boyington declared that an oak tree would spring from his grave as proof of his innocence. The tree fulfilled his prophecy, and visitors report seeing his spirit sitting beneath its branches.",
                features: ["Tree Spirit Manifestations", "Wrongful Death Energy", "Apparitions Under Oak", "Historical Injustice"],
                activityLevel: "moderate",
                yearEstablished: 1835,
                type: "Cemetery"
            },
            {
                id: "al010",
                state: "AL",
                name: "Pratt Hall - Huntingdon College",
                city: "Montgomery",
                coordinates: [32.3617, -86.3009],
                story: "In the early 20th century, when Huntingdon was still the Woman's College of Alabama, a lonely student named Martha struggled with depression and isolation. After her only friend moved away, Martha was found dead in her fourth-floor room, dressed in her red robe. Her spirit, known as the Red Lady, continues to haunt Pratt Hall.",
                features: ["Red Lady Apparition", "Glowing Red Lights", "Tragic Student Spirit", "Dormitory Hauntings"],
                activityLevel: "high",
                yearEstablished: 1854,
                type: "College"
            },
            {
                id: "al011",
                state: "AL",
                name: "The Redmont Hotel",
                city: "Birmingham",
                coordinates: [33.5186, -86.8025],
                story: "Birmingham's oldest active hotel, operating since 1925, houses multiple spirits within its historic walls. Country music legend Hank Williams spent his final night here in 1952 before his tragic death, and his spirit reportedly lingers in the penthouse. The hotel is also haunted by former owner Clifford Stiles and a mysterious woman in white.",
                features: ["Celebrity Ghost", "Woman in White", "Ghost Dog", "Moving Furniture"],
                activityLevel: "moderate",
                yearEstablished: 1925,
                type: "Hotel"
            },
            {
                id: "al012",
                state: "AL",
                name: "The Tutwiler Hotel",
                city: "Birmingham",
                coordinates: [33.5186, -86.8025],
                story: "This Birmingham landmark is home to a playful yet mischievous spirit known as 'The Knocker,' believed to be Colonel Tutwiler himself. The ghost delights in knocking on guest room doors throughout the night, turning lights and appliances on and off, and occasionally preparing elaborate meals in the kitchen.",
                features: ["Door Knocking", "Light Manipulation", "Kitchen Activity", "Polite Ghost Interactions"],
                activityLevel: "moderate",
                yearEstablished: 1914,
                type: "Hotel"
            },
            {
                id: "al013",
                state: "AL",
                name: "Alabama Theatre",
                city: "Birmingham",
                coordinates: [33.5186, -86.8025],
                story: "Built in 1927 as a showcase for silent films, this ornate theater harbors the spirits of those who died during its construction and operation. A construction worker who fell to his death from the balcony still haunts that area, while a mysterious Lady in Black vanishes into walls in the lobby.",
                features: ["Construction Worker Spirit", "Lady in Black", "Musician Ghost", "Phantom Touches"],
                activityLevel: "moderate",
                yearEstablished: 1927,
                type: "Theater"
            },
            {
                id: "al014",
                state: "AL",
                name: "Lucas Tavern",
                city: "Montgomery",
                coordinates: [32.3617, -86.3009],
                story: "Operating from 1820-1840 as an upscale travelers' inn, this establishment was run by the gracious Eliza Lucas. After being restored in 1980 as part of Old Alabama Town, Eliza's benevolent spirit returned to continue her hostess duties. She's known to express disapproval of bad manners by blasting ash and smoke at rude visitors.",
                features: ["Benevolent Hostess Spirit", "Victorian Apparition", "Polite Ghost Interactions", "Southern Hospitality"],
                activityLevel: "low",
                yearEstablished: 1820,
                type: "Historic House"
            },
            {
                id: "al015",
                state: "AL",
                name: "Jack Cole Road",
                city: "Hayden",
                coordinates: [33.8940, -86.7656],
                story: "This half-mile stretch of unpaved road has witnessed 68 deaths since 1890, including 60 victims of a cholera outbreak at a hospital that once stood here in 1900. The remaining eight deaths were due to mysterious murders and unexplained circumstances. Most disturbing are glimpses of a deformed creature described as half-wolf, half-man.",
                features: ["Disease Victim Spirits", "Mysterious Lights", "Cryptid Sightings", "Murder Victim Ghosts"],
                activityLevel: "high",
                yearEstablished: 1890,
                type: "Road"
            },
            
            // Cemetery Locations
            {
                id: "al016",
                state: "AL",
                name: "Maple Hill Cemetery",
                city: "Huntsville",
                coordinates: [34.7304, -86.5861],
                story: "Established in 1822, this 100-acre cemetery is Alabama's oldest and largest, serving as the final resting place for over 80,000 souls. During the Civil War, it became the burial ground for 187 unknown Confederate soldiers and numerous Union troops. The 1918 Spanish flu epidemic added thousands more, many of whom were children.",
                features: ["Children's Laughter", "Self-Moving Swings", "Civil War Spirits", "Orbs in Photos"],
                activityLevel: "high",
                yearEstablished: 1822,
                type: "Cemetery"
            },
            {
                id: "al017",
                state: "AL",
                name: "Adams Grove Cemetery",
                city: "Sardis",
                coordinates: [32.1232, -85.4869],
                story: "Located next to the historic Adams Grove Presbyterian Church built in 1853, this cemetery is considered one of Alabama's most haunted burial grounds. Dating back to the 1800s, it serves as the final resting place for Confederate soldiers, enslaved people, and local citizens. The cemetery is terrorized by a shadowy figure with fiery red eyes.",
                features: ["Red-Eyed Shadow Figure", "Baby Crying", "Confederate Soldier Spirits", "Day and Night Activity"],
                activityLevel: "high",
                yearEstablished: 1853,
                type: "Cemetery"
            },
            {
                id: "al018",
                state: "AL",
                name: "Bass Cemetery",
                city: "Irondale",
                coordinates: [33.5342, -86.6769],
                story: "Located near Ruffner Road, this 150-200 year old cemetery is one of the Birmingham area's oldest burial grounds. The oldest known grave belongs to Burwell Bass, a Revolutionary War soldier who died in 1831. Also buried here is Montezuma Goodwin, a farmer murdered by his brother-in-law in 1904.",
                features: ["Unexplained Screams", "Revolutionary War Spirits", "Floating Orbs", "Mysterious Mists"],
                activityLevel: "moderate",
                yearEstablished: 1831,
                type: "Cemetery"
            },
            {
                id: "al019",
                state: "AL",
                name: "Church Street Graveyard",
                city: "Mobile",
                coordinates: [30.6944, -88.0444],
                story: "This historic Mobile cemetery is home to the famous Boyington Oak, a massive Southern live oak that grew from Charles Boyington's grave after his wrongful execution for murder in 1835. Phantom cries and whispers emanate from the area around the ancient oak, where his spirit seeks eternal vindication.",
                features: ["Tree Spirit Manifestations", "Phantom Cries", "Wrongful Death Energy", "Historical Injustice"],
                activityLevel: "moderate",
                yearEstablished: 1835,
                type: "Cemetery"
            },
            {
                id: "al020",
                state: "AL",
                name: "Old Live Oak Cemetery",
                city: "Selma",
                coordinates: [32.4074, -87.0211],
                story: "Founded in 1829 in historic Selma, this moss-draped cemetery serves as the final resting place for numerous Civil War soldiers and prominent town members, including Benjamin Sterling Turner, the first Black U.S. Representative for Alabama during Reconstruction. The cemetery expanded significantly after the Civil War.",
                features: ["Civil War Spirits", "Spanish Moss Apparitions", "Historical Figures", "Post-War Expansion Ghosts"],
                activityLevel: "moderate",
                yearEstablished: 1829,
                type: "Cemetery"
            },
            {
                id: "al021",
                state: "AL",
                name: "Oak Hill Cemetery",
                city: "Birmingham",
                coordinates: [33.5186, -86.8025],
                story: "Located in Birmingham with a stunning view of the city skyline, this historic cemetery houses the grave of John T. Milner, the railroad engineer whose projects paved the way for Birmingham's development. The cemetery is home to the mysterious Erswell Vault, where visitors report hearing whispers and mutterings from Catherine Erswell.",
                features: ["Vault Whispers", "City Builder Spirits", "Mutterings from Tombs", "Railroad Pioneer Ghost"],
                activityLevel: "moderate",
                yearEstablished: 1869,
                type: "Cemetery"
            },
            {
                id: "al022",
                state: "AL",
                name: "Clearwater Cemetery",
                city: "Wagarville",
                coordinates: [31.3182, -87.0350],
                story: "This cemetery is haunted by a ghostly white lady who appears on the dirt road outside the gates between midnight and 3 AM. Local legend tells of an unidentified woman who was brutally assaulted and murdered either in the cemetery or on the road many years ago. Her restless spirit now appears to travelers seeking justice.",
                features: ["White Lady Apparition", "Midnight to 3AM Activity", "Murder Victim Spirit", "Road Hauntings"],
                activityLevel: "high",
                yearEstablished: 1800,
                type: "Cemetery"
            },
            {
                id: "al023",
                state: "AL",
                name: "Hodges Cemetery",
                city: "Gardendale",
                coordinates: [33.6551, -86.8119],
                story: "This remote cemetery is notorious for terrorizing motorists who pass by. Drivers report objects banging against their cars, ghostly hands or faces appearing on windows, and being chased by a wolf with glowing red eyes accompanied by a mysterious glowing light. Shadowy figures dart between tombstones.",
                features: ["Vehicle Harassment", "Glowing Red-Eyed Wolf", "Moving Tombstones", "Shadow Figure Activity"],
                activityLevel: "high",
                yearEstablished: 1850,
                type: "Cemetery"
            },
            {
                id: "al024",
                state: "AL",
                name: "Gallant Children's Cemetery",
                city: "Gallant",
                coordinates: [34.1184, -86.2011],
                story: "This small cemetery is dedicated to children and is said to be haunted by friendly child spirits who come out to play with each other late at night. Despite their cheerful nature, visitors report having their hair pulled, experiencing sudden sickness, and being pushed by invisible hands.",
                features: ["Friendly Child Spirits", "Physical Interactions", "Tree Face Manifestations", "Nighttime Playfulness"],
                activityLevel: "moderate",
                yearEstablished: 1890,
                type: "Cemetery"
            },
            {
                id: "al025",
                state: "AL",
                name: "Cardiff Cemetery",
                city: "Graysville",
                coordinates: [33.6198, -86.9661],
                story: "Located in Graysville, this cemetery is known for its mysterious orbs and strange lights that appear throughout the graveyard with no traceable source. The cemetery has gained a peculiar reputation for automotive interference - cars may stop dead on Friday the 13th and have trouble starting for five minutes.",
                features: ["Mysterious Orbs", "Friday the 13th Car Trouble", "Strange Lights", "Automotive Interference"],
                activityLevel: "moderate",
                yearEstablished: 1880,
                type: "Cemetery"
            },
            {
                id: "al026",
                state: "AL",
                name: "Cooley Cemetery",
                city: "Anniston",
                coordinates: [33.6597, -85.8316],
                story: "Located on Brindle Mountain near Manchester Drive, this off-the-beaten-path cemetery dates back to the Civil War era. The cemetery experiences supernatural mist phenomena where a mysterious fog will cover only the tombstones while leaving the surrounding woodlands completely clear.",
                features: ["Selective Supernatural Mist", "Cold Breezes", "Unmarked Grave Spirits", "Mountain Isolation"],
                activityLevel: "moderate",
                yearEstablished: 1865,
                type: "Cemetery"
            },
            {
                id: "al027",
                state: "AL",
                name: "Harper Hill Church & Cemetery",
                city: "Dadeville",
                coordinates: [32.8301, -85.7635],
                story: "This abandoned and deteriorating site has been left to decay for many years, but its former residents refuse to rest peacefully. Local legend tells of a minister who went utterly insane over a century ago and murdered his entire family before taking his own life within the church walls.",
                features: ["Family Murder Spirits", "Abandoned Church Hauntings", "Insane Minister Ghost", "Deteriorating Sacred Ground"],
                activityLevel: "high",
                yearEstablished: 1870,
                type: "Cemetery"
            },
            {
                id: "al028",
                state: "AL",
                name: "Easly Cemetery",
                city: "Jasper",
                coordinates: [33.8312, -87.2775],
                story: "This cemetery is known for its aggressive supernatural phenomena that manifest primarily at night. Visitors commonly encounter a fiery red orb that floats through the graveyard and has been known to chase people who venture too close. A white phantom figure has also been spotted on the adjacent road.",
                features: ["Chasing Fire Orbs", "White Phantom Figure", "Visitor Illness", "Screaming Sounds"],
                activityLevel: "high",
                yearEstablished: 1885,
                type: "Cemetery"
            },
            {
                id: "al029",
                state: "AL",
                name: "New Providence Cemetery",
                city: "Coy",
                coordinates: [32.2879, -86.3658],
                story: "Also known as Coy Cemetery, this burial ground serves as the final resting place for many prominent African Americans from the area's history. The cemetery is illuminated by mysterious lights that glow above the graves with no traceable earthly source, creating an otherworldly atmosphere.",
                features: ["Mysterious Grave Lights", "Disembodied Voices", "African American History", "Untraceable Light Sources"],
                activityLevel: "moderate",
                yearEstablished: 1870,
                type: "Cemetery"
            },
            {
                id: "al030",
                state: "AL",
                name: "Cemetery Mountain",
                city: "Munford",
                coordinates: [33.5329, -85.9497],
                story: "Located in Munford, this aptly named location features scattered graves across a mountain. Local tales speak of an old abandoned church somewhere on the mountain containing a pedestal bearing a single book. Legend claims the book can be lifted but becomes impossibly heavy as you approach the church door.",
                features: ["Scattered Mountain Graves", "Mysterious Heavy Book", "Abandoned Church", "Supernatural Weight Phenomena"],
                activityLevel: "moderate",
                yearEstablished: 1860,
                type: "Cemetery"
            },
            {
                id: "al031",
                state: "AL",
                name: "Little Vine Cemetery",
                city: "Empire",
                coordinates: [33.8184, -86.8119],
                story: "This small cemetery near the Little Vine Church possesses a simple but persistent supernatural phenomenon. A faint green light appears above the gravestones during the night hours, visible to motorists driving past the cemetery. The consistent nature of the green light sightings has earned it recognition.",
                features: ["Faint Green Light", "Nighttime Manifestations", "Roadside Sightings", "Consistent Phenomena"],
                activityLevel: "low",
                yearEstablished: 1875,
                type: "Cemetery"
            },
            {
                id: "al032",
                state: "AL",
                name: "Consolation Church Cemetery",
                city: "Red Level",
                coordinates: [31.4054, -86.6208],
                story: "This abandoned church and cemetery complex was left to deteriorate for years before the church building was destroyed by fire in 2015. During its abandonment, visitors reported Confederate soldiers, ghostly children, and a shrieking banshee. Most terrifying were sightings of hellhounds with glowing red eyes.",
                features: ["Confederate Soldier Spirits", "Ghostly Children", "Shrieking Banshee", "Hellhounds with Red Eyes"],
                activityLevel: "high",
                yearEstablished: 1850,
                type: "Cemetery"
            },
            {
                id: "al033",
                state: "AL",
                name: "Village Falls Cemetery",
                city: "Birmingham",
                coordinates: [33.4734, -86.8074],
                story: "This Birmingham-area cemetery has gained attention from paranormal investigators and visitors who report hearing unknown voices while walking among the graves. The disembodied voices seem to engage visitors in conversation, though the words are often unclear or fragmented.",
                features: ["Unknown Voices", "Disembodied Conversations", "Multiple Spirit Activity", "Vocal Manifestations"],
                activityLevel: "moderate",
                yearEstablished: 1890,
                type: "Cemetery"
            },
            {
                id: "al034",
                state: "AL",
                name: "Bladon Springs Cemetery",
                city: "Bladon Springs",
                coordinates: [31.6790, -88.1119],
                story: "Located near the Tombigbee River, this cemetery holds the tragic story of the steamboat James T. Staples disaster of 1913. Twenty-six souls died when the ship exploded and sank. Captain Norman Staples, who had lost the ship to creditors and committed suicide, is buried here. His sad spirit patrols the grounds.",
                features: ["Steamboat Disaster Spirits", "Captain's Eternal Vigil", "River Tragedy Ghosts", "Multiple Family Deaths"],
                activityLevel: "moderate",
                yearEstablished: 1900,
                type: "Cemetery"
            },
            {
                id: "al035",
                state: "AL",
                name: "Pine Hill Cemetery",
                city: "Auburn",
                coordinates: [32.6099, -85.4808],
                story: "This cemetery was established in 1863 close to a Confederate hospital relocated from Vicksburg, Mississippi after the city's fall during the Civil War. Most graves belong to Confederate soldiers, though tradition holds that unmarked graves beyond the back fence contain Union soldiers.",
                features: ["Civil War Hospital Spirits", "Union and Confederate Ghosts", "Full Apparitions", "Physical Contact from Spirits"],
                activityLevel: "moderate",
                yearEstablished: 1863,
                type: "Cemetery"
            },
        ];

        let currentDisplayedLocations = [];

        // Activity level colors for map markers
        const activityColors = {
            high: '#ff4444',
            moderate: '#ffaa44',
            low: '#44ff44'
        };

        // Initialize the application
        function initializeApp() {
            updateStatistics();
            displayAllLocations();
        }

        // Filter and display locations based on current selections
        function filterAndDisplayLocations() {
            const stateFilter = document.getElementById('stateFilter').value;
            const typeFilter = document.getElementById('locationType').value;
            const activityFilter = document.getElementById('activityLevel').value;
            const sortOrder = document.getElementById('sortOrder').value;

            // Filter locations
            let filteredLocations = hauntedLocations.filter(location => {
                const stateMatch = !stateFilter || location.state === stateFilter;
                const typeMatch = !typeFilter || location.type === typeFilter;
                const activityMatch = !activityFilter || location.activityLevel === activityFilter;
                return stateMatch && typeMatch && activityMatch;
            });

            // Sort locations based on selected option
            filteredLocations = sortLocations(filteredLocations, sortOrder);

            currentDisplayedLocations = filteredLocations;
            
            // Show loading
            document.getElementById('locationsList').innerHTML = '<div class="loading">üîÆ Filtering haunted locations...</div>';
            
            setTimeout(() => {
                displayLocationsOnMap(filteredLocations);
                displayLocationsList(filteredLocations);
                updateDisplayedCount(filteredLocations.length);
                
                // Center map on filtered results
                if (filteredLocations.length > 0) {
                    centerMapOnLocations(filteredLocations);
                }
            }, 1000);
        }

        // Sort locations based on selected criteria
        function sortLocations(locations, sortBy) {
            const sortedLocations = [...locations];
            
            switch(sortBy) {
                case 'alphabetical':
                    return sortedLocations.sort((a, b) => a.name.localeCompare(b.name));
                case 'alphabetical-desc':
                    return sortedLocations.sort((a, b) => b.name.localeCompare(a.name));
                case 'activity':
                    const activityOrder = { 'high': 3, 'moderate': 2, 'low': 1 };
                    return sortedLocations.sort((a, b) => {
                        const aOrder = activityOrder[a.activityLevel];
                        const bOrder = activityOrder[b.activityLevel];
                        return bOrder - aOrder;
                    });
                case 'year':
                    return sortedLocations.sort((a, b) => a.yearEstablished - b.yearEstablished);
                case 'type':
                    return sortedLocations.sort((a, b) => a.type.localeCompare(b.type));
                case 'city':
                    return sortedLocations.sort((a, b) => a.city.localeCompare(b.city));
                default:
                    return sortedLocations.sort((a, b) => a.name.localeCompare(b.name));
            }
        }

        // Display all locations initially
        function displayAllLocations() {
            const sortOrder = document.getElementById('sortOrder')?.value || 'alphabetical';
            const sortedLocations = sortLocations(hauntedLocations, sortOrder);
            currentDisplayedLocations = sortedLocations;
            displayLocationsOnMap(sortedLocations);
            displayLocationsList(sortedLocations);
            updateDisplayedCount(sortedLocations.length);
        }

        // Center map on a set of locations
        function centerMapOnLocations(locations) {
            if (locations.length === 0) return;
            
            if (locations.length === 1) {
                map.setView(locations[0].coordinates, 10);
            } else {
                const group = new L.featureGroup(locations.map(loc => 
                    L.marker(loc.coordinates)
                ));
                map.fitBounds(group.getBounds().pad(0.1));
            }
        }

        // Display locations on map
        function displayLocationsOnMap(locations) {
            markersGroup.clearLayers();

            locations.forEach(location => {
                const hauntedIcon = L.divIcon({
                    className: 'haunted-marker',
                    html: 'üëª',
                    iconSize: [30, 30],
                    iconAnchor: [15, 15]
                });

                const marker = L.marker(location.coordinates, {
                    icon: hauntedIcon
                }).addTo(markersGroup);

                const popupContent = `
                    <h3>${location.name}</h3>
                    ${location.imageUrl ? `
                        <img src="${location.imageUrl}" 
                             alt="${location.name}" 
                             style="width: 100%; max-width: 200px; height: auto; border-radius: 5px; margin: 10px 0;"
                             onerror="this.style.display='none'">
                    ` : ''}
                    <p><strong>Location:</strong> ${location.city}, ${location.state}</p>
                    <p><strong>Type:</strong> ${location.type}</p>
                    <p><strong>Activity Level:</strong> ${location.activityLevel}</p>
                    <p><strong>Story:</strong> ${location.story.substring(0, 150)}...</p>
                `;

                marker.bindPopup(popupContent, {
                    maxWidth: 300,
                    className: 'haunted-popup'
                });

                marker.on('click', () => {
                    // Remove highlight from any previously highlighted cards
                    document.querySelectorAll('.location-card.highlighted').forEach(card => {
                        card.classList.remove('highlighted');
                });
    
                const locationCard = document.querySelector(`[data-id="${location.id}"]`);
                if (locationCard) {
                    // Add highlight class for the pulsing effect
                    locationCard.classList.add('highlighted');
        
                    // Scroll to the card
                    locationCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
        
                    // Remove highlight after 3 seconds
                    setTimeout(() => {
                        locationCard.classList.remove('highlighted');
                    }, 3000);
            }
});
        }

        // Display locations list
        function displayLocationsList(locations) {
            const listContainer = document.getElementById('locationsList');
            
            listContainer.innerHTML = locations.map(location => `
                <div class="location-card activity-${location.activityLevel}" data-id="${location.id}">
                    ${location.imageUrl ? `
                        <div class="location-image">
                            <img src="${location.imageUrl}" 
                                 alt="${location.name}" 
                                 onerror="this.style.display='none'"
                                 loading="lazy">
                        </div>
                    ` : ''}
                    <div class="location-title">${location.name}</div>
                    <div class="coordinates">üìç ${location.city}, ${location.state}</div>
                    <div class="location-type">${location.type}</div>
                    <div class="location-story">${location.story}</div>
                    <div class="location-features">
                        <h4>Reported Phenomena:</h4>
                        <div class="features-list">
                            ${location.features.map(feature => `<span class="feature-tag">${feature}</span>`).join('')}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Update statistics
        function updateStatistics() {
            const totalCount = hauntedLocations.length;
            const highActivityCount = hauntedLocations.filter(loc => loc.activityLevel === 'high').length;
            
            document.getElementById('totalLocations').textContent = totalCount;
            document.getElementById('highActivity').textContent = highActivityCount;
        }

        // Update displayed count
        function updateDisplayedCount(count) {
            document.getElementById('displayedCount').textContent = count;
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
        });

        // Add event listeners for filtering
        document.getElementById('stateFilter').addEventListener('change', filterAndDisplayLocations);
        document.getElementById('locationType').addEventListener('change', filterAndDisplayLocations);
        document.getElementById('activityLevel').addEventListener('change', filterAndDisplayLocations);
        document.getElementById('sortOrder').addEventListener('change', filterAndDisplayLocations);
    </script>
</body>
</html>
